<!doctype html>
<html>
	<head>
		<title>Socket.IO chat</title>
		<link rel="stylesheet" href="public/style.css"></link>
	</head>
	<body onresize="resizeFunction()">
		<div id="messagediv">
			<div id="innderdiv"><ul id="messages"></ul></div>
		</div>
		<form action="">
			<input id="m" autocomplete="off" /><button>Send</button>
		</form>
	</body>
	<script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
	<script>
		var socket = io();
		var whoami = prompt("Please enter your name", "Mystery guest");
		socket.emit('statusMessage', whoami + ' connected.');	
		$('form').submit(function(){
			var message = $('#m').val();
			var datas = {
				"chatMessage": message,
				"user": whoami
			};
			socket.emit('chatMessage', JSON.stringify(datas));
			$('#m').val('');
			return false;
		});
		
		socket.on('chatMessage', function(message){
			var $msgdiv = $('#messagediv');
			message = JSON.parse(message);
			var line = "<li> <span class='user'>" + message.user + "</span>: " + message.chatMessage + "</li>";
			$('#messages').append(line);
			console.log($('#messages')[0].scrollHeight);
			$('body').scrollTop(('#messages')[0].scrollHeight + $('#messagediv')[0].scrollHeight);
			console.log($('#messages')[0].scrollHeight);
		});
		
		socket.on('statusMessage', function(message){
			$('#messages').append($('<li>').text(message))
		});
		
		resizeFunction(){
			$('#messagediv').css('height',  $(document).height() - 45 + "px")
		}
		
		$(document).ready(function(){
			$('#messagediv').bind("DOMSubtreeModified", function(){
				$('#messagediv').animate({
					scrollTop: $('#messagediv')[0].scrollHeight
				});
			});
		});
	</script>
</html>