<!doctype html>
<html>
	<head>
		<title>Socket.IO chat</title>
		<link rel="stylesheet" href="public/style.css"></link>
	</head>
	<body>
		<ul id="messages"></ul>
			<form action="">
			<input id="m" autocomplete="off" /><button>Send</button>
			</form>
	</body>
	<script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
	<script src="http://code.jquery.com/jquery-1.11.1.js"></script>
	<script>
		var socket = io();
		var whoami = prompt("Please enter your name", "Mystery guest");
		socket.emit('statusMessage', whoami + ' connected.');	
		$('form').submit(function(){
			var message = $('#m').val();
			var datas = {
				"chatMessage": message,
				"user": whoami
			};
			console.log('Sending data');
			socket.emit('chatMessage', JSON.stringify(datas));
			$('#m').val('');
			return false;
		});
		socket.on('chatMessage', function(message){
			var $msg = $('#messages');
			message = JSON.parse(message);
			var line = "<li> <span class='user'>" + message.user + "</span>: " + message.chatMessage + "</li>";
			$msg.append(line);
			console.log($msg[0].scrollHeight);
			$msg.animate({scrollTop: $msg[0].scrollHeight}, 1000);
		});
		socket.on('statusMessage', function(message){
			$('#messages').append($('<li>').text(message))
		});
	</script>
</html>